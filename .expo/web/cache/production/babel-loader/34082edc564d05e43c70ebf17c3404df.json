{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";import React,{Component}from'react';import{Text}from'native-base';import{MenuIcon}from\"../../components/sidemenu/menu.icon\";import api,{Authorization}from\"../../utils/connection.api\";import HTTP from\"../../utils/http.codes\";import cartStorage from\"../../storage/cart.storage\";import userSession from\"../../storage/user.session\";import{CartScreenView}from\"./cart\";export var CartScreen=function(_Component){_inherits(CartScreen,_Component);function CartScreen(props){var _this;_classCallCheck(this,CartScreen);_this=_possibleConstructorReturn(this,_getPrototypeOf(CartScreen).call(this,props));_this.state={items:[],total:0.0};return _this;}_createClass(CartScreen,[{key:\"updateItems\",value:function updateItems(){var _this2=this;cartStorage.get().then(function(items){_this2.setState({items:items});var total=0.0;items.forEach(function(item){total+=item.price*item.amount;});_this2.setState({total:total});});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this3=this;this.focusListener=this.props.navigation.addListener('didFocus',function(){_this3.updateItems();});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.focusListener.remove();}},{key:\"remove\",value:function remove(item){var _this4=this;cartStorage.remove(item).then(function(){_this4.updateItems();});}},{key:\"invoice\",value:function invoice(){var _this5=this;userSession.getToken().then(function(token){api.setHeader(Authorization,\"Bearer \"+token);api.post('sales/order/invoice',_this5.state.items).then(function(result){if(result.status===HTTP.BAD_REQUEST){alert(\"Você precisa logar como Cliente para fechar o pedido!\");_this5.props.navigation.navigate('Login');}else if(result.status===HTTP.FORBIDDEN){alert(\"Você precisa logar para fechar o pedido!\");_this5.props.navigation.navigate('Login');}else if(result.status===HTTP.OK){cartStorage.clear();_this5.props.navigation.navigate('SalesOrder');}else{alert(\"Erro ao buscar os pedidos: \"+JSON.stringify(result.data));}});});}},{key:\"render\",value:function render(){return React.createElement(CartScreenView,{items:this.state.items,total:this.state.total,actions:this});}}]);return CartScreen;}(Component);CartScreen.navigationOptions=function(_ref){var navigation=_ref.navigation;return{headerTitle:function headerTitle(){return React.createElement(Text,null,\"Carrinho de Compras\");},headerLeft:function headerLeft(){return React.createElement(MenuIcon,{navigation:navigation});}};};","map":{"version":3,"sources":["/Users/uedsonreis/Documents/Projetos/faculdades/example-ecommerce-react/src/screens/cart/index.tsx"],"names":["React","Component","Text","MenuIcon","api","Authorization","HTTP","cartStorage","userSession","CartScreenView","CartScreen","props","state","items","total","get","then","setState","forEach","item","price","amount","focusListener","navigation","addListener","updateItems","remove","getToken","token","setHeader","post","result","status","BAD_REQUEST","alert","navigate","FORBIDDEN","OK","clear","JSON","stringify","data","navigationOptions","headerTitle","headerLeft"],"mappings":"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","sourcesContent":["import React, { Component, ReactNode } from 'react';\nimport { Text } from 'native-base';\n\nimport { MenuIcon } from '../../components/sidemenu/menu.icon';\nimport api, { Authorization } from '../../utils/connection.api';\nimport HTTP from '../../utils/http.codes';\nimport { Item } from '../../model/item';\nimport cartStorage from '../../storage/cart.storage';\nimport userSession from '../../storage/user.session';\nimport { CartScreenView } from './cart';\n\ntype State = { items: Item[], total: number }\n\nexport class CartScreen extends Component<any, State> {\n\n    static navigationOptions = ({ navigation }) => {\n        return {\n            headerTitle: () => <Text>Carrinho de Compras</Text>,\n            headerLeft: () => (\n                <MenuIcon navigation={navigation} />\n            )\n        };\n    };\n\n    private focusListener: any;\n\n    constructor(props: any) {\n        super(props);\n        this.state = {\n            items: [],\n            total: 0.0\n        };\n    }\n\n    private updateItems(): void {\n        cartStorage.get().then((items: Item[]) => {\n            this.setState({ items: items });\n\n            let total: number = 0.0;\n\n            items.forEach((item: Item) => {\n                total += item.price * item.amount;\n            });\n\n            this.setState({ total: total });\n        });\n    }\n\n    componentDidMount(): void {\n        this.focusListener = this.props.navigation.addListener('didFocus', () => {\n            this.updateItems();\n        });\n    }\n\n    componentWillUnmount(): void {\n        this.focusListener.remove();\n    }\n\n    public remove(item: Item): void {\n        cartStorage.remove(item).then(() => {\n            this.updateItems();\n        });\n    }\n\n    public invoice(): void {\n        userSession.getToken().then((token: string) => {\n            api.setHeader(Authorization, \"Bearer \"+ token);\n\n            api.post('sales/order/invoice', this.state.items).then((result: any) => {\n                if (result.status === HTTP.BAD_REQUEST) {\n                    alert(\"Você precisa logar como Cliente para fechar o pedido!\");\n                    this.props.navigation.navigate('Login');\n                } else if (result.status === HTTP.FORBIDDEN) {\n                    alert(\"Você precisa logar para fechar o pedido!\");\n                    this.props.navigation.navigate('Login');\n                } else if (result.status === HTTP.OK) {\n                    cartStorage.clear();\n                    this.props.navigation.navigate('SalesOrder');\n                } else {\n                    alert(\"Erro ao buscar os pedidos: \"+JSON.stringify(result.data));\n                }\n            });\n        });\n    }\n\n    public render(): ReactNode {\n        return (\n            <CartScreenView items={this.state.items} total={this.state.total} actions={this} />\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}